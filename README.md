# Mail_agent
Этот проект представляет собой автоматический почтовый агент , который обрабатывает входящие письма и отправляет ответы, используя модель GPT для генерации текста.

Предпосылки:
---------
После пножества проектов ботов в Телеграме, автоматизация почты давно просилась, как логичное решение.

Ключевые задачи проекта: 
- настроить устойчивую связь агента для получения и отправки сообщений.
- решить проблему кодировки, а местами даже шифрования почты.
- учесть, что не все письма нужно обрабатывать.
- дать возможность пользователю управлять настройками агента.

Внезапное решение:
---------
Обработку почты через GPT настроил исключительно для теста, чтобы имитировать отправку ответов различного формата. 

Десятки отправленных сообщений для отладки кода открыли глаза - это готовое решение для личного ассистента, которое не блокируется корпоративными настройками безопасности! Главное, отправлять обезличенные запросы.

Задачи проетка я конечно решил, но и получил удобного помощника :)


Предпосылки:
---------

Основные функции
---------
Загрузка настроек из файла

Файл settings.txt используется для хранения конфиденциальных данных (серверы IMAP/SMTP, логин, пароль, API-ключ для GPT).
Если файл отсутствует, программа создает его шаблоном настроек.

Декодирование заголовков и текста писем

decode_mime_words(s): Расшифровывает кодированные MIME-заголовки писем.
safe_decode(payload): Пытается декодировать традиционные письма разными методами, включая UTF-8, KOI8-R, Latin-1 и другие.
Очистка текста от лишних символов

get_gpt_response(prompt): Отправляет запрос в API GPT с заданной подсказкой и возвращает текстовый ответ.
Поддерживается кастомизация модели, температуры и URL API.
Преобразование текста Markdown в HTML

markdown_to_html(md_text): Преобразует ответ из GPT из Markdown в формате HTML для отправки по электронной почте.
Обработка почты и отправка ответов

Подключение к IMAP-серверу для поиска новых (непрочитанных) писем.
Проверка отправителя на соответствие списку ALLOWED_SENDERS.
Извлечение текста из писем и его очистка.
Генерация ответа с помощью GPT, добавление исходного текста в тело ответа.
Отправка ответа с сохранением темы письма.
